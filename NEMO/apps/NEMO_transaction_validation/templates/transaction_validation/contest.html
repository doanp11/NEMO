{% extends 'base.html' %}
{% load static %}
{% block title %}Contest usage event{% endblock %}
{% block extrahead %}
	<script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
	<link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}"/>
{% endblock %}
{% block content %}
	<h1>Contest Usage Event</h1>

	<p>You have selected the Usage Event detailed below to contest. Please select a general reason this item should be contested and enter a description of the specifics. Once this form is submitted, the Usage Event will be placed in contested status until an administrator can review the record and address it as needed.</p>

	<form id="contest_form" class="form-horizontal" role="form" style="margin-top: 20px">
		<div class="form-group">
			<label for="operator" class="col-md-2 control-label"><b>Operator</b></label>
			<div class="col-md-10">
				<select id="operator" name="operator" class="form-control">
					{% for u in user_list %}
					<option {% if usage_event.operator.id == u.id %}selected {% endif %}>{{ u }}</option>
					{% endfor %}
				</select>
			</div>
		</div>
		<div class="form-group">
			<label for="customer" class="col-md-2 control-label"><b>Customer</b></label>
			<div class="col-md-10">
				<select id="customer" name="customer" class="form-control">
					{% for u in user_list %}
					<option {% if usage_event.user.id == u.id %}selected {% endif %}>{{ u }}</option>
					{% endfor %}
				</select>
			</div>
		</div>
		<div class="form-group">
			<label for="project" class="col-md-2 control-label"><b>Project</b></label>
			<div class="col-md-10">
				<select id="project" name="project" class="form-control">
					{% for p in project_list %}
					<option {% if usage_event.project.id == p.id %}selected {% endif %}>{{ p }}</option>
					{% endfor %}
				</select>
			</div>
		</div>
		<div class="form-group">
			<label for="start_date" class="col-md-2 control-label"><b>Start</b></label>
			<div class="col-md-4">
				<input type="text" id="start_date" name="start_date" class="form-control text-left" value="{{ start_date|date:'l, F jS, Y' }} @ {{ start_date|time:'g:i A' }}">
			</div>
		</div>
		<div class="form-group">
			<label for="end_date" class="col-md-2 control-label"><b>End</b></label>
			<div class="col-md-4">
				<input type="text" id="end_date" name="end_date" class="form-control text-left" value="{{ end_date|date:'l, F jS, Y' }} @ {{ end_date|time:'g:i A' }}">
			</div>
		</div>
		<div class="form-group">
			<label for="tool" class="col-md-2 control-label"><b>Tool</b></label>
			<div class="col-md-10">
				<select id="tool" name="tool_id" class="form-control">
					{% for t in tool_list %}
					<option {% if usage_event.tool.id == t.id %}selected {% endif %} value="{{ t.id }}">{{ t }}</option>
					{% endfor %}
				</select>
			</div>
		</div>
		<div style="border-top: 1px solid #ddd"><br></div>
		<div class="form-group">
			<label for="contest_reason" class="col-md-2 control-label"><b>Contest Reason</b></label>
			<div class="col-md-10">
				<select id="contest_reason" name="contest_reason" class="form-control" required>
					<option disabled selected>Please select a contest reason</option>
					<option>Incorrect operator selection</option>
					<option>Incorrect customer selection</option>
					<option>Incorrect project selection</option>
					<option>Incorrect date selection</option>
					<option>Incorrect tool selection</option>
				</select>
			</div>
		</div>
		<div class="form-group">
			<label class="col-md-2 control-label"><b>Contest Description</b></label>
			<div class="col-md-10">
				<textarea id="contest_description" name="contest_description" class="form-control" rows="3"></textarea>
			</div>
		</div>
		<div class="form-group">
			<div class="col-md-2"></div>
			<div class="col-md-10"><button type="button" class="btn btn-default btn-md" onclick="window.location.href='{% url 'transaction_validation' %}'">Submit contest</button></div>
		</div>
	</form>

	<script>
		let start_date_jq = $('#start_date');
		let end_date_jq = $('#end_date');
		start_date_jq.datetimepicker({format: 'dddd, MMMM Do, YYYY @ h:mm A'});
		end_date_jq.datetimepicker({format: 'dddd, MMMM Do, YYYY @ h:mm A'});

		function set_dropdown_selected()
		{
			if ('{{ start_date }}' && '{{ end_date }}')
			{
				let start = moment('{{ start_date|date:'l, F jS, Y' }} @ {{ start_date|time:'g:i A' }}');
				let end = moment('{{ end_date|date:'l, F jS, Y' }} @ {{ end_date|time:'g:i A' }}');
				if (start.month() === end.month() && start.year() === end.year() && start.format('MM/DD/YYYY') === start.startOf('month').format('MM/DD/YYYY') && end.format('MM/DD/YYYY') === end.endOf('month').format('MM/DD/YYYY'))
				{
					let month = start.format("MMMM, YYYY");
					$('#month_list').val(month)
				}
			}
		}
		$(set_dropdown_selected());
	</script>

{% endblock %}